<section class="establishment" id="establishment">
    <div class="header" style="background-image: url({{estData.path}});">
      <div class="content"></div>
    </div>
    <div class="content-text">
      <div class="text-container">
        <h2>
            {{estData.name}}
            <div class="star-rating">
              
                <i class="fas fa-star star-icon"></i>
               
            </div>
        </h2>
        <span class="rating">Rating: <%= averageRating.toFixed(1) %>/5 (<%= loopPosts.length %> review/s)</span>
        <a href="" class="custom-button">Review Now</a>
      </div>
    </div>

    <div class="description-content">
      <img src="{{estData.icon}}" class="aligned-image">
      <p class="image-description">
        {{estData.description}}
      </p>
    </div>

    

    {{#each postData}}
      <div class="comment-container">
        <div class="profile-picture">
          <img src="sprites/agno.jpg" alt="Profile Picture">
        </div>
        <div class="comment-content">
          <span class="comment-author">
            {{this.cust_name}}
          </span>
          &nbsp &nbsp &nbsp
          <span class="comment-author">
            {{this.rating}}/5
          </span>

          <p class="comment-text">
            {{this.review}}
          </p>
          <span class="comment-time">143 hours ago</span>
          <div class="comment-buttons">
            <input type="hidden" id="postid" value="{{this._id}}" >
            <button id="helpful" class="helpful-button">Helpful 
                {{this.helpful_num}}</button>
            <button id="nothelpful" >Not Helpful 
                {{this.nothelpful_num}}</button>

            <form action="/comment" method="POST">
              <textarea placeholder="write a comment..." name="comment"></textarea>
              <div class="row button">
                <!-- <input type="submit" value="comment_btn" id="login-btn"> -->
                <button type="submit" value="comment_btn" id="login-btn">Add Comment</button>

                <!-- Hidden input field -->
                <input type="hidden" name="post_number" value="<%= loopPosts[i]._id %>">
              </div>
            </form>

          </div>

        </div>
      </div>
      {{/each}}

      <script>
        const helpfulBtn = document.querySelector('#helpful');
        const postid = document.querySelector('#postid');
        const nothelpfulBtn = document.querySelector('#nothelpful');

        helpfulBtn.addEventListener('click', async function (e) {
          e.preventDefault();
          const postId = postid.value;  
          const response = await fetch('/updateHelpful?postId=' + postId,{
              method: 'GET',
          });
          if (response.status == 400) {
              helpfulBtn.innerText = "Helpful " + (parseInt(helpfulBtn.innerText.substring(8)) + 1).toString();
          } else if (response.status == 200){
              console.log('ok');
          }
        });

        nothelpfulBtn.addEventListener('click', async function (e) {
          e.preventDefault();
          const postId = postid.value;  
          const response = await fetch('/updateNotHelpful?postId=' + postId,{
              method: 'GET',
          });
          if (response.status == 400) {
              nothelpfulBtn.innerText = "Not Helpful " + (parseInt(nothelpfulBtn.innerText.substring(12)) + 1).toString();
          } else if (response.status == 200){
              console.log('ok');
          }
        });
        
      </script>
    

  </section>